name: Auto Review & Fix

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  auto-review:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Review & Comment
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          echo "🔄 Starting auto-review process..."
          
          # Request Copilot review via PR comment
          echo "📝 Requesting Copilot review..."
          gh pr review $PR_NUMBER --comment -b "🤖 @copilot, please review this PR for any critical issues, bugs, security concerns, or improvements. Focus on:
          - Code quality and best practices
          - Potential bugs or logic errors
          - Security vulnerabilities
          - Performance issues
          - Flutter/Dart specific concerns"
          
          # Wait for review to be posted
          echo "⏳ Waiting for Copilot review..."
          sleep 30
          
          # Add success comment
          gh pr comment $PR_NUMBER --body "✅ **Otomatik review tamamlandı!** 
          
Copilot review isteği gönderildi. Review tamamlandıktan sonra:
- Kritik sorunlar varsa, bunları düzeltip tekrar push edin
- Sorun yoksa PR'ı merge edebilirsiniz

**Not:** Bu otomatik bir mesajdır. Copilot review'ünü yukarıda kontrol edin. 🚀"
